<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Простая VR игра</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.3/dist/aframe-super-hands.min.js"></script>
  <script>
    AFRAME.registerComponent('gun-shoot', {
      init: function () {
        const el = this.el;
        el.addEventListener('triggerdown', () => {
          const bullet = document.createElement('a-sphere');
          bullet.setAttribute('radius', '0.05');
          bullet.setAttribute('color', 'black');

          const gunWorldPos = new THREE.Vector3();
          const gunWorldQuat = new THREE.Quaternion();
          el.object3D.getWorldPosition(gunWorldPos);
          el.object3D.getWorldQuaternion(gunWorldQuat);
          bullet.setAttribute('position', gunWorldPos);

          const direction = new THREE.Vector3(0, 0, -1); // направление "вперёд"
          direction.applyQuaternion(gunWorldQuat);
          bullet.setAttribute('velocity', {
            x: direction.x * 10,
            y: direction.y * 10,
            z: direction.z * 10
          });

          bullet.setAttribute('dynamic-body', 'mass: 0.1;');
          el.sceneEl.appendChild(bullet);
        });
      }
    });
  </script>
</head>
<body>
  <a-scene physics="debug: false">
    <!-- Камера -->
    <a-entity id="cameraRig" position="0 1.6 0">
      <a-entity camera wasd-controls look-controls></a-entity>
    </a-entity>

    <!-- Пистолет, привязанный к правому контроллеру -->
    <a-entity id="gun" laser-controls="hand: right" gun-shoot rotation="0 0 0">
      <a-box width="0.05" height="0.05" depth="0.3" color="#333" position="0 0 -0.15"></a-box>
    </a-entity>

    <!-- Плоскость -->
    <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>

    <!-- Примеры целей -->
    <a-sphere position="0 1.25 -5" radius="0.3" color="#EF2D5E"></a-sphere>
    <a-box position="-1 1.5 -4" depth="0.4" height="0.4" width="0.4" color="#4CC3D9"></a-box>
    <a-cylinder position="1 1.3 -3" radius="0.2" height="0.6" color="#FFC65D"></a-cylinder>

    <a-sky color="#ECECEC"></a-sky>
  </a-scene>
</body>
</html>
